name: Update LeetCode Ranking

on:
  push:
    branches: [ master, main ]
    paths:
      - '*/0-easy/*.ts'
      - '*/1-medium/*.ts'
      - '*/2-hard/*.ts'
      - '!README.md'
      - '!*/index.ts'

jobs:
  update-ranking:
    runs-on: ubuntu-latest
    
    if: "!contains(github.event.head_commit.message, '[auto-update]')"
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: Debug - List files
      run: |
        echo "=== Estrutura do projeto ==="
        ls -la
        echo "=== ConteÃºdo da pasta 3-scripts ==="
        ls -la 3-scripts/
        echo "=== Verificando update-ranking.sh ==="
        if [ -f "./3-scripts/update-ranking.sh" ]; then
          echo "âœ… Arquivo existe"
          file ./3-scripts/update-ranking.sh
        else
          echo "âŒ Arquivo nÃ£o encontrado"
        fi

    - name: Make scripts executable
      run: |
        chmod +x ./3-scripts/*.sh
        echo "=== PermissÃµes apÃ³s chmod ==="
        ls -la ./3-scripts/

    - name: Update ranking
      run: |
        bash ./3-scripts/update-ranking.sh

    - name: Check for changes in README
      id: verify-changed-files
      run: |
        if git diff --quiet README.md; then
          echo "changed=false" >> $GITHUB_OUTPUT
          echo "âŒ Nenhuma alteraÃ§Ã£o no ranking detectada"
        else
          echo "changed=true" >> $GITHUB_OUTPUT
          echo "âœ… Ranking atualizado - alteraÃ§Ãµes detectadas no README.md"
          git diff --name-only
        fi

    - name: Commit and push ranking update
      if: steps.verify-changed-files.outputs.changed == 'true'
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "LeetCode Ranking Bot"
        git add README.md
        git commit -m "ðŸ¤– [auto-update] Update LeetCode ranking

        - Updated statistics for all contributors
        - Updated solved problems list
        
        Auto-generated by GitHub Actions"
        git push